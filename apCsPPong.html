<html>
	<head>
		<title>
			Pong
		</title>
		<style>
			body {
				background-color: RGB(0,0,0);
			}
			body * {
				margin: 0;
				padding: 0;
				cursor: default;
			}
			body button, body input {
				cursor: pointer;
			}
			body *::selection {
				color: RGB(0,0,0);
				background-color: RGB(255,255,255);
			}
			body *:focus {
				outline: none;
			}
			p, h1, h2, button, label {
				color: RGB(255,255,255);
				font-family: "Arial", sans-serif;
			}
			.framed {
				background-color: RGB(0,0,0);
				border: 0.5vw solid RGB(255,255,255);
			}
			.framed.thin {
				border-width: 0.25vw;
			}
			#canvas {
				z-index: 0;
				height: 80vh;
				width: 80vh;
				position: fixed;
				top: 10vh;
				left: calc(50vw - 40vh);
			}
			#title {
				z-index: 0;
				height: auto;
				width: auto;
				position: fixed;
				top: 2vh;
				left: 5vw;
				text-align: left;
				font-size: 6vh;
			}
			#configuration {
				z-index: 0;
				height: calc(10vh - 1vw);
				width: 100vw;
				position: fixed;
				bottom: 0;
				left: 0;
				border-top: 0.5vw solid RGB(255,255,255);
			}
			button:hover, input:hover {
				background-color: RGB(64,64,64);
			}
			button:active, input:focus {
				background-color: RGB(32,32,32);
			}
			#configuration > button {
				z-index: 1;
				font-size: 2vw;
				width: 20%;
				height: 80%;
				position: absolute;
				top: 10%;
			}
			#openKeyBindings {
				right: 5%;
			}
			#openScoring {
				right: 30%;
			}
			#openVisuals {
				right: 55%;
			}
			.popup {
				z-index: 2;
				width: 90vh;
				height: 90vh;
				position: fixed;
				top: 5vh;
				left: calc(50vw - 45vh);
				padding: 9vh;
			}
			.popup * {
				z-index: 3;
			}
			.popup.disabled {
				display: none;
			}
			.popup.enabled {
				display: block;
			}
			.popupClose {
				width: 5%;
				height: 5%;
				position: absolute;
				top: 1.25%;
				left: 1.25%;
			}
			.popupConfig > p, .popup.config > button:not(.popupClose) {
				margin: 4.5vh;
				padding: 0;
				font-size: 4.5vh;
				position: relative;
				top: 0;
				left: 0;
				background-color: RGB(255,0,0);
			}
			.popup.config > p > label {
				/*
				margin: 4.5vh;
				*/
				position: absolute;
				left: 0;
				top: 50%;
				transform: translateY(-50%);
				font-size: 4.5vh;
			}
			.popup.config > p > input {
				/*
				margin: 4.5vh;
				*/
				display: block;
				position: absolute;
				right: 0;
				top: 50%;
				transform: translateY(-50%);
				font-size: 4.5vh;
				width: 18vh;
			}
			#errorMessage > h2, #errorMessage > p {
				color: RGB(255,0,0);
				margin-left: 5%;
				margin-right: 5%;
			}
			#errorMessageHeader {
				margin-top: 5%;
				margin-bottom: 2.5%;
			}
			#errorMessageBody {
				margin-top: 2.5%;
				margin-bottom: 5%;
			}
		</style>
	</head>
	<body>
		<h1 id="title">
			Pong
		</h1>
		<canvas class="framed" id="canvas">
		</canvas>
		<div id="configuration">
			<button class="framed thin" id="openKeyBindings">
				Key Bindings
			</button>
			<div class="popup config framed disabled" id="keyBindings">
				<button class="popupClose framed thin" id="closeKeyBindings">
					X
				</button>
				<p>
					<label for="keyPaddle0Up">
						Paddle 0 Up
					</label>
					<input type="text" readonly="true" class="framed thin" id="keyPaddle0Up">
					</input>
				</p>
				<p>
					<label for="keyPaddle0Down">
						Paddle 0 Down
					</label>
					<input type="text" readonly="true" class="framed thin" id="keyPaddle0Down">
					</input>
				</p>
				<p>
					<label for="keyPaddle1Up">
						Paddle 1 Up
					</label>
					<input type="text" readonly="true" class="framed thin" id="keyPaddle1Up">
					</input>
				</p>
				<p>
					<label for="keyPaddle1Down">
						Paddle 1 Down
					</label>
					<input type="text" readonly="true" class="framed thin" id="keyPaddle1Down">
					</input>
				</p>
				<p>
					<label for="keyClose">
						Close
					</label>
					<input type="text" readonly="true" class="framed thin" id="keyClose">
					</input>
				</p>
			</div>
			<button class="framed thin" id="openScoring">
				Scoring
			</button>
			<div class="popup config framed disabled" id="scoring">
				<button class="popupClose framed thin" id="closeScoring">
					X
				</button>
			</div>
			<button class="framed thin" id="openVisuals">
				Visuals
			</button>
			<div class="popup config framed disabled" id="visuals">
				<button class="popupClose framed thin" id="closeVisuals">
					X
				</button>
			</div>
		</div>
		<div class="popup framed disabled" id="errorMessage">
			<h2 id="errorMessageHeader">
				An Error Has Occurred:
			</h2>
			<p id="errorMessageBody">
			</p>
		</div>
	</body>
	<script>
		//<gui>
		var openKeyBindings = document.getElementById("openKeyBindings");
		var keyBindings = document.getElementById("keyBindings");
		var closeKeyBindings = document.getElementById("closeKeyBindings");
		openKeyBindings.addEventListener("click", function() {
			keyBindings.classList.remove("disabled");
			keyBindings.classList.add("enabled");
		});
		closeKeyBindings.addEventListener("click", function() {
			keyBindings.classList.remove("enabled");
			keyBindings.classList.add("disabled");
		});
		//</gui>
		//<game & gui>
		var w = window.innerWidth;
		var h = window.innerHeight;
		var canvas = document.getElementById("canvas");
		canvas.width = w;
		canvas.height = h;
		var c = canvas.getContext("2d");
		//</game & gui>
		//<game>
		setActiveCanvas("canvas");
		setFillColor("#000000");
		c.fillRect(0, 0, w, h);
		setFillColor("#FFFFFF");
		/*
		positionSize = {
			{
				{paddle0X, paddle0Y},
				{paddle0W, paddle0H}
			},
			{
				{paddle1X, paddle1Y},
				{paddle1W, paddle1H}
			},
			{
				{ballX, ballY},
				{ballW, ballH}
			}
		}
		*/
		var padding = w / 8;
		var ballR = w / 32;
		positionSize = [
			[
				[padding, (h / 2) - (w / 8)],
				[w / 16, w / 4]
			],
			[
				[w - padding - (w / 16), (h / 2) - (w / 8)],
				[w / 16, w / 4]
			],
			[
				[w / 2, h / 2],
				[2 * ballR, 2 * ballR]
			]
		];
		c.fillRect(positionSize[0][0][0], positionSize[0][0][1], positionSize[0][1][0], positionSize[0][1][1]);
		c.fillRect(positionSize[1][0][0], positionSize[1][0][1], positionSize[1][1][0], positionSize[1][1][1]);
		c.arc(positionSize[2][0][0], positionSize[2][0][1], ballR, 0, 2 * Math.PI);
		textLabel("errorMessage", "An error has occurred:");
		hideElement("errorMessage");
		var errorH = 3 * w / 8;
		var errorW = w / 2;
		setSize("errorMessage", errorW, errorH);
		setPosition("errorMessage", w / 2 - errorW / 2, h / 2 - errorH / 2);
		setProperty("errorMessage", "background-color", "#000000");
		setProperty("errorMessage", "border-color", "#FFFFFF");
		setProperty("errorMessage", "border-width", w / 64);
		function moveObject(object, x, y, relativePositioning) {
			var objectType = 0;
			switch (object) {
				case 0:
				case 1:
					objectType = 0;
					break;
				case 2:
					objectType = 1;
					break;
				default:
					return undefined;
			};
			if (objectType === 0) {
				setFillColor("#000000");
				c.fillRect(positionSize[object][0][0], positionSize[object][0][1], positionSize[object][1][0], positionSize[object][1][1]);
				setFillColor("#FFFFFF");
			} else {
				setFillColor("#000000");
				c.fillRect(positionSize[object][0][0] - (positionSize[object][1][0] / 2), positionSize[object][0][1] - (positionSize[object][1][1] / 2), positionSize[object][1][0], positionSize[object][1][1]);
				setFillColor("#FFFFFF");
			};
			if (relativePositioning) {
				positionSize[object][0][0] += x;
				positionSize[object][0][1] += y;
			} else {
				positionSize[object][0][0] = x;
				positionSize[object][0][1] = y;
			};
			if (objectType === 0) {
				c.fillRect(positionSize[object][0][0], positionSize[object][0][1], positionSize[object][1][0], positionSize[object][1][1]);
			} else {
				c.arc(positionSize[object][0][0], positionSize[object][0][1], positionSize[object][1][0] / 2, 0, 2 * Math.PI);
			};
		};
		var paddleMovementLoop = [0, 0];
		function paddleMovement(paddle, state, direction) {
			stopTimedLoop(paddleMovementLoop[paddle]);
			if (state) {
				paddleMovementLoop[paddle] = timedLoop(10, function() {
					var d0 = ((h / 50) * direction);
					var d = positionSize[paddle][0][1] + d0
					if (d < 0) {
						d0 = -positionSize[paddle][0][1];
					} else if (d + positionSize[paddle][1][1] > h) {
						d0 = h - (positionSize[paddle][0][1] + positionSize[paddle][1][1]);
					};
					moveObject(paddle, 0, d0, true);
				});
			};
		};
		//keyBindings = {paddle0Up, paddle0Down, paddle1Up, paddle1Down}
		var keyBindings = ["w", "s", "Up", "Down"];
		function errorHandling(errorObject) {
			setText("errorMessage", "errorMessage", "An error has occurred:\n" + errorObject.name + ": " + errorObject.message);
			showElement("errorMessage");
		};
		onEvent("screen1", "keydown", function(e) {
			try {
				var key = e.key;
				switch (key) {
					case keyBindings[0]:
		  				paddleMovement(0, true, -1);
		  				break;
		  			case keyBindings[1]:
						paddleMovement(0, true, 1);
						break;
					case keyBindings[2]:
						paddleMovement(1, true, -1);
						break;
					case keyBindings[3]:
						paddleMovement(1, true, 1);
						break;
					default:
						break;
				};
			} catch (e) {
				errorHandling(e);
			};
		});
		onEvent("screen1", "keyup", function(e) {
			try {
				var key = e.key;
				switch(key) {
					case keyBindings[0]:
						paddleMovement(0, false, -1);
						break;
					case keyBindings[1]:
						paddleMovement(0, false, 1);
						break;
					case keyBindings[2]:
						paddleMovement(1, false, -1);
						break;
					case keyBindings[3]:
						paddleMovement(1, false, 1);
						break;
					default:
						break;
				};
			} catch (e) {
				errorHandling(e);
		  };
		});
		//ballVelocity = {Magnitude, direction (radian angle), x vector, y vector}
		var ballVelocity = [h / 200, Math.random() * Math.PI, ballVelocity[0] * Math.cos(ballVelocity[1]), ballVelocity[0] * Math.sin(ballVelocity[1])];
		var ballMovement = timedLoop(10, function() {
			//check if it hits something. If so, both only put it as close as it can get (cut both x and y vectors equally), and then do any reflections or whatever if so.
			moveObject(2, ?, ?, true);
		});
		//</game>
	</script>
</html>
